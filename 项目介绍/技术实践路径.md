# ç½‘çƒç¤¾äº¤å¹³å°æŠ€æœ¯å®è·µè·¯å¾„

## æŠ€æœ¯æ ˆæ¦‚è¿°

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ ¸å¿ƒæ¡†æ¶/å¹³å°:** Expo (Managed Workflow)
- **UI åº“:** React Native
- **ç¼–ç¨‹è¯­è¨€:** TypeScript
- **UI ç»„ä»¶åº“:** React Native Paper (æˆ– React Native Elements)
- **é¡µé¢å¯¼èˆª:** React Navigation
- **çŠ¶æ€ç®¡ç†:** Zustand (æˆ– Jotai)
- **API è¯·æ±‚:** Axios

### åç«¯æŠ€æœ¯æ ˆ
- **æ ¸å¿ƒæ¡†æ¶:** Python + FastAPI
- **æ•°æ®åº“:** PostgreSQL (æ¨èä½¿ç”¨äº‘ RDS æœåŠ¡)
- **ORM:** SQLAlchemy
- **æ•°æ®åº“è¿ç§»:** Alembic
- **è®¤è¯:** JWT (python-jose)
- **å¯†ç åŠ å¯†:** passlib[bcrypt]

## ä¸€ã€å¼€å‘ç¯å¢ƒå‡†å¤‡

### 1.1 å¼€å‘å·¥å…·å®‰è£…

#### å‰ç«¯å¼€å‘ç¯å¢ƒ
```bash
# Node.js (æ¨è v18 LTSæˆ–ä»¥ä¸Š)
# ä¸‹è½½åœ°å€: https://nodejs.org/

# å®‰è£… Expo CLI (æ ¸å¿ƒæ¡†æ¶)
npm install -g expo-cli

# æˆ–ä½¿ç”¨ npx (æ¨èï¼Œæ— éœ€å…¨å±€å®‰è£…)
# npx create-expo-app@latest

# Expo Go App (ç”¨äºå¼€å‘æµ‹è¯•)
# Android: Google Play ä¸‹è½½
# iOS: App Store ä¸‹è½½

# Android Studio (Androidå¼€å‘ï¼Œå¯é€‰ - ç”¨äºæœ¬åœ°æ„å»º)
# ä¸‹è½½åœ°å€: https://developer.android.com/studio

# Xcode (iOSå¼€å‘ï¼Œä»…Macï¼Œå¯é€‰ - ç”¨äºæœ¬åœ°æ„å»º)
# Mac App Store ä¸‹è½½
```

#### åç«¯å¼€å‘ç¯å¢ƒ
```bash
# Python 3.9+ (æ ¸å¿ƒè¯­è¨€)
# ä¸‹è½½åœ°å€: https://www.python.org/downloads/

# FastAPI (æ ¸å¿ƒæ¡†æ¶)
# é€šè¿‡ requirements.txt å®‰è£…ï¼Œè¯¦è§é¡¹ç›®åˆå§‹åŒ–éƒ¨åˆ†

# å®‰è£… Poetry (æ¨èçš„ä¾èµ–ç®¡ç†å·¥å…·)
pip install poetry

# æˆ–ä½¿ç”¨ pip + virtualenv
pip install virtualenv
```

#### æ•°æ®åº“å·¥å…·
```bash
# PostgreSQL (æ ¸å¿ƒæ•°æ®åº“ï¼Œæ¨èä½¿ç”¨äº‘ RDS æœåŠ¡)
# æœ¬åœ°å¼€å‘: ä¸‹è½½åœ°å€: https://www.postgresql.org/download/
# äº‘æœåŠ¡: é˜¿é‡Œäº‘ RDS PostgreSQL / AWS RDS PostgreSQL

# æ•°æ®åº“ç®¡ç†å·¥å…·
# DBeaver: https://dbeaver.io/ (æ¨è)
# æˆ– pgAdmin: https://www.pgadmin.org/
```

#### ç‰ˆæœ¬æ§åˆ¶
```bash
# Git
# ä¸‹è½½åœ°å€: https://git-scm.com/

# åˆå§‹åŒ–ä»“åº“
git init
```

### 1.2 IDE æ¨è
- **å‰ç«¯ï¼š** VS Code + Expo Tools æ’ä»¶ + React Native Tools æ’ä»¶
- **åç«¯ï¼š** PyCharm / VS Code + Python æ’ä»¶
- **æ•°æ®åº“ï¼š** DBeaver Community

## äºŒã€é¡¹ç›®åˆå§‹åŒ–

### 2.1 é¡¹ç›®ç»“æ„è®¾è®¡

```
tennis_app/
â”œâ”€â”€ mobile/                 # Expo å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ screens/       # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/    # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ navigation/    # å¯¼èˆªé…ç½®
â”‚   â”‚   â”œâ”€â”€ services/      # API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ store/         # Zustand/Jotai çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ utils/         # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ assets/        # é™æ€èµ„æº
â”‚   â”œâ”€â”€ app.json           # Expo é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json      # TypeScript é…ç½®
â”‚   â””â”€â”€ App.tsx            # åº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ backend/               # FastAPI åç«¯
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/          # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ models/       # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ schemas/      # Pydantic schemas
â”‚   â”‚   â”œâ”€â”€ services/     # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ core/         # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ db/           # æ•°æ®åº“é…ç½®
â”‚   â”‚   â””â”€â”€ utils/        # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ alembic/          # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ tests/            # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ main.py
â”‚
â”œâ”€â”€ docs/                  # æ–‡æ¡£
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

### 2.2 åˆå§‹åŒ– Expo é¡¹ç›®

```bash
# ä½¿ç”¨ Expo åˆ›å»º TypeScript é¡¹ç›®
npx create-expo-app TennisApp --template
cd TennisApp

# å®‰è£…å¯¼èˆªç›¸å…³ä¾èµ–
npm install @react-navigation/native @react-navigation/stack @react-navigation/bottom-tabs
npx expo install react-native-screens react-native-safe-area-context

# å®‰è£…çŠ¶æ€ç®¡ç†åº“ (é€‰æ‹©å…¶ä¸€)
npm install zustand
# æˆ–
npm install jotai

# å®‰è£… API è¯·æ±‚åº“
npm install axios

# å®‰è£…æœ¬åœ°å­˜å‚¨
npm install @react-native-async-storage/async-storage
npx expo install @react-native-async-storage/async-storage

# å®‰è£…å›¾ç‰‡é€‰æ‹©å™¨
npx expo install expo-image-picker

# å®‰è£…åœ°å›¾ç»„ä»¶ (å¯é€‰)
npx expo install react-native-maps

# å®‰è£… UI ç»„ä»¶åº“ (é€‰æ‹©å…¶ä¸€)
npm install react-native-paper
# æˆ–
npm install @rneui/themed @rneui/base

# å®‰è£…å›¾æ ‡åº“
npm install react-native-vector-icons
npx expo install @expo/vector-icons

# å¼€å‘æ¨¡å¼å¯åŠ¨
npx expo start
# æˆ–ä½¿ç”¨å¼€å‘å·¥å…·
npx expo start --tunnel
```

### 2.3 åˆå§‹åŒ– FastAPI é¡¹ç›® (Python + FastAPI)

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir backend
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows:
venv\Scripts\activate
# Mac/Linux:
source venv/bin/activate

# åˆ›å»º requirements.txt
# æ ¸å¿ƒä¾èµ–ï¼šFastAPI + PostgreSQL (psycopg2-binary)
```

**requirements.txt å†…å®¹ï¼š**
```txt
fastapi==0.104.1
uvicorn[standard]==0.24.0
sqlalchemy==2.0.23
psycopg2-binary==2.9.9
alembic==1.12.1
pydantic==2.5.0
pydantic-settings==2.1.0
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6
aiofiles==23.2.1
pillow==10.1.0
python-dotenv==1.0.0
httpx==0.25.2
pytest==7.4.3
pytest-asyncio==0.21.1
```

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

## ä¸‰ã€åç«¯å¼€å‘å®è·µ (Python + FastAPI + PostgreSQL)

### 3.1 æ•°æ®åº“è®¾è®¡ä¸è¿æ¥ (PostgreSQL)

#### åˆ›å»ºæ•°æ®åº“é…ç½®æ–‡ä»¶

**backend/app/core/config.py**
```python
from pydantic_settings import BaseSettings
from typing import Optional

class Settings(BaseSettings):
    # æ•°æ®åº“é…ç½®
    DATABASE_URL: str = "postgresql://username:password@localhost:5432/tennis_db"
    
    # JWT é…ç½®
    SECRET_KEY: str = "your-secret-key-change-in-production"
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
    
    # é˜¿é‡Œäº‘ OSS é…ç½®
    ALIYUN_OSS_ACCESS_KEY_ID: Optional[str] = None
    ALIYUN_OSS_ACCESS_KEY_SECRET: Optional[str] = None
    ALIYUN_OSS_BUCKET_NAME: Optional[str] = None
    ALIYUN_OSS_ENDPOINT: Optional[str] = None
    
    # åº”ç”¨é…ç½®
    APP_NAME: str = "Tennis Social Platform"
    DEBUG: bool = True
    
    class Config:
        env_file = ".env"

settings = Settings()
```

**backend/app/db/database.py**
```python
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
from app.core.config import settings

engine = create_engine(settings.DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

Base = declarative_base()

# æ•°æ®åº“ä¾èµ–æ³¨å…¥
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

### 3.2 æ•°æ®æ¨¡å‹å®šä¹‰

**backend/app/models/user.py**
```python
from sqlalchemy import Column, Integer, String, DateTime, Enum
from sqlalchemy.sql import func
from app.db.database import Base
import enum

class SkillLevel(str, enum.Enum):
    BEGINNER = "beginner"
    INTERMEDIATE = "intermediate"
    ADVANCED = "advanced"
    PROFESSIONAL = "professional"

class User(Base):
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True, index=True)
    username = Column(String, unique=True, index=True, nullable=False)
    email = Column(String, unique=True, index=True, nullable=False)
    phone = Column(String, unique=True, nullable=True)
    hashed_password = Column(String, nullable=False)
    avatar = Column(String, nullable=True)
    skill_level = Column(Enum(SkillLevel), default=SkillLevel.BEGINNER)
    bio = Column(String, nullable=True)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())
```

**backend/app/models/post.py**
```python
from sqlalchemy import Column, Integer, String, DateTime, ForeignKey, ARRAY, Text
from sqlalchemy.sql import func
from sqlalchemy.orm import relationship
from app.db.database import Base

class Post(Base):
    __tablename__ = "posts"
    
    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    content = Column(Text, nullable=False)
    images = Column(ARRAY(String), nullable=True)
    location = Column(String, nullable=True)
    tags = Column(ARRAY(String), nullable=True)
    likes_count = Column(Integer, default=0)
    comments_count = Column(Integer, default=0)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())
    
    # å…³ç³»
    user = relationship("User", backref="posts")
```

**backend/app/models/match.py**
```python
from sqlalchemy import Column, Integer, String, DateTime, ForeignKey, Enum, Float, Text
from sqlalchemy.sql import func
from sqlalchemy.orm import relationship
from app.db.database import Base
import enum

class MatchStatus(str, enum.Enum):
    OPEN = "open"
    FULL = "full"
    COMPLETED = "completed"
    CANCELLED = "cancelled"

class Match(Base):
    __tablename__ = "matches"
    
    id = Column(Integer, primary_key=True, index=True)
    creator_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    title = Column(String, nullable=False)
    description = Column(Text, nullable=True)
    location = Column(String, nullable=False)
    scheduled_time = Column(DateTime(timezone=True), nullable=False)
    max_participants = Column(Integer, default=4)
    skill_requirement = Column(String, nullable=True)
    cost = Column(Float, default=0.0)
    status = Column(Enum(MatchStatus), default=MatchStatus.OPEN)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    
    # å…³ç³»
    creator = relationship("User", backref="created_matches")
    participants = relationship("MatchParticipant", back_populates="match")
```

### 3.3 API è·¯ç”±å®ç°

**backend/app/api/auth.py**
```python
from fastapi import APIRouter, Depends, HTTPException, status
from fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm
from sqlalchemy.orm import Session
from datetime import timedelta
from app.db.database import get_db
from app.core.config import settings
from app.schemas.user import UserCreate, UserResponse, Token
from app.services.auth import create_user, authenticate_user, create_access_token

router = APIRouter(prefix="/auth", tags=["authentication"])

@router.post("/register", response_model=UserResponse)
async def register(user: UserCreate, db: Session = Depends(get_db)):
    """ç”¨æˆ·æ³¨å†Œ"""
    return create_user(db, user)

@router.post("/login", response_model=Token)
async def login(
    form_data: OAuth2PasswordRequestForm = Depends(),
    db: Session = Depends(get_db)
):
    """ç”¨æˆ·ç™»å½•"""
    user = authenticate_user(db, form_data.username, form_data.password)
    if not user:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
        )
    
    access_token = create_access_token(
        data={"sub": user.username},
        expires_delta=timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
    )
    
    return {"access_token": access_token, "token_type": "bearer"}
```

**backend/app/api/posts.py**
```python
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session
from typing import List
from app.db.database import get_db
from app.schemas.post import PostCreate, PostResponse
from app.services.post import create_post, get_posts, get_post_by_id
from app.api.deps import get_current_user
from app.models.user import User

router = APIRouter(prefix="/posts", tags=["posts"])

@router.post("/", response_model=PostResponse, status_code=status.HTTP_201_CREATED)
async def create_new_post(
    post: PostCreate,
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_user)
):
    """åˆ›å»ºæ–°åŠ¨æ€"""
    return create_post(db, post, current_user.id)

@router.get("/", response_model=List[PostResponse])
async def list_posts(
    skip: int = 0,
    limit: int = 20,
    db: Session = Depends(get_db)
):
    """è·å–åŠ¨æ€åˆ—è¡¨"""
    return get_posts(db, skip=skip, limit=limit)

@router.get("/{post_id}", response_model=PostResponse)
async def get_post(post_id: int, db: Session = Depends(get_db)):
    """è·å–å•ä¸ªåŠ¨æ€è¯¦æƒ…"""
    post = get_post_by_id(db, post_id)
    if not post:
        raise HTTPException(status_code=404, detail="åŠ¨æ€ä¸å­˜åœ¨")
    return post
```

### 3.4 ä¸»åº”ç”¨å…¥å£

**backend/main.py**
```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.core.config import settings
from app.api import auth, posts, matches, users
from app.db.database import engine, Base

# åˆ›å»ºæ•°æ®åº“è¡¨
Base.metadata.create_all(bind=engine)

app = FastAPI(title=settings.APP_NAME)

# CORS é…ç½®
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # ç”Ÿäº§ç¯å¢ƒéœ€è¦æŒ‡å®šå…·ä½“åŸŸå
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# æ³¨å†Œè·¯ç”±
app.include_router(auth.router)
app.include_router(posts.router)
app.include_router(matches.router)
app.include_router(users.router)

@app.get("/")
async def root():
    return {"message": "Welcome to Tennis Social Platform API"}

@app.get("/health")
async def health_check():
    return {"status": "healthy"}

if __name__ == "__main__":
    import uvicorn
    uvicorn.run("main:app", host="0.0.0.0", port=8000, reload=True)
```

### 3.5 è¿è¡Œåç«¯æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼è¿è¡Œ
cd backend
uvicorn main:app --reload --host 0.0.0.0 --port 8000

# è®¿é—® API æ–‡æ¡£
# http://localhost:8000/docs  (Swagger UI)
# http://localhost:8000/redoc (ReDoc)
```

## å››ã€å‰ç«¯å¼€å‘å®è·µ

### 4.1 é¡¹ç›®é…ç½®

**mobile/app.json**
```json
{
  "expo": {
    "name": "Tennis Social Platform",
    "slug": "tennis-app",
    "version": "1.0.0",
    "orientation": "portrait",
    "icon": "./assets/icon.png",
    "userInterfaceStyle": "light",
    "splash": {
      "image": "./assets/splash.png",
      "resizeMode": "contain",
      "backgroundColor": "#ffffff"
    },
    "assetBundlePatterns": [
      "**/*"
    ],
    "ios": {
      "supportsTablet": true,
      "bundleIdentifier": "com.tennis.app"
    },
    "android": {
      "adaptiveIcon": {
        "foregroundImage": "./assets/adaptive-icon.png",
        "backgroundColor": "#ffffff"
      },
      "package": "com.tennis.app"
    },
    "web": {
      "favicon": "./assets/favicon.png"
    }
  }
}
```

**mobile/src/config/api.ts**
```typescript
export const API_CONFIG = {
  BASE_URL: __DEV__ 
    ? 'http://localhost:8000'  // å¼€å‘ç¯å¢ƒ
    : 'https://api.tennis.yourdomain.com', // ç”Ÿäº§ç¯å¢ƒ
  TIMEOUT: 10000,
};
```

### 4.2 çŠ¶æ€ç®¡ç†é…ç½® (Zustand)

**mobile/src/store/authStore.ts**
```typescript
import { create } from 'zustand';
import AsyncStorage from '@react-native-async-storage/async-storage';

interface AuthState {
  token: string | null;
  isAuthenticated: boolean;
  setToken: (token: string | null) => void;
  logout: () => Promise<void>;
}

export const useAuthStore = create<AuthState>((set) => ({
  token: null,
  isAuthenticated: false,
  
  setToken: async (token: string | null) => {
    if (token) {
      await AsyncStorage.setItem('access_token', token);
      set({ token, isAuthenticated: true });
    } else {
      await AsyncStorage.removeItem('access_token');
      set({ token: null, isAuthenticated: false });
    }
  },
  
  logout: async () => {
    await AsyncStorage.removeItem('access_token');
    set({ token: null, isAuthenticated: false });
  },
}));

// åˆå§‹åŒ–æ—¶ä» AsyncStorage æ¢å¤ token
AsyncStorage.getItem('access_token').then((token) => {
  if (token) {
    useAuthStore.getState().setToken(token);
  }
});
```

**mobile/src/store/postStore.ts** (ç¤ºä¾‹)
```typescript
import { create } from 'zustand';

interface Post {
  id: number;
  content: string;
  images?: string[];
  likes_count: number;
}

interface PostState {
  posts: Post[];
  loading: boolean;
  setPosts: (posts: Post[]) => void;
  addPost: (post: Post) => void;
  setLoading: (loading: boolean) => void;
}

export const usePostStore = create<PostState>((set) => ({
  posts: [],
  loading: false,
  setPosts: (posts) => set({ posts }),
  addPost: (post) => set((state) => ({ posts: [post, ...state.posts] })),
  setLoading: (loading) => set({ loading }),
}));
```

### 4.3 API æœåŠ¡å°è£…

**mobile/src/services/api.ts**
```typescript
import axios from 'axios';
import { API_CONFIG } from '../config/api';
import { useAuthStore } from '../store/authStore';

const apiClient = axios.create({
  baseURL: API_CONFIG.BASE_URL,
  timeout: API_CONFIG.TIMEOUT,
});

// è¯·æ±‚æ‹¦æˆªå™¨ - æ·»åŠ  token
apiClient.interceptors.request.use(
  async (config) => {
    const token = useAuthStore.getState().token;
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// å“åº”æ‹¦æˆªå™¨ - å¤„ç†é”™è¯¯
apiClient.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      await useAuthStore.getState().logout();
      // å¯¼èˆªåˆ°ç™»å½•é¡µ
    }
    return Promise.reject(error);
  }
);

export default apiClient;
```

**mobile/src/services/authService.ts**
```typescript
import apiClient from './api';
import { useAuthStore } from '../store/authStore';

export interface LoginCredentials {
  username: string;
  password: string;
}

export interface RegisterData {
  username: string;
  email: string;
  password: string;
}

export const authService = {
  async login(credentials: LoginCredentials) {
    const formData = new FormData();
    formData.append('username', credentials.username);
    formData.append('password', credentials.password);
    
    const response = await apiClient.post('/auth/login', formData);
    useAuthStore.getState().setToken(response.data.access_token);
    return response.data;
  },
  
  async register(data: RegisterData) {
    const response = await apiClient.post('/auth/register', data);
    return response.data;
  },
  
  async logout() {
    await useAuthStore.getState().logout();
  },
};
```

### 4.4 å¯¼èˆªé…ç½®

**mobile/src/navigation/AppNavigator.tsx**
```typescript
import React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createStackNavigator } from '@react-navigation/stack';
import { createBottomTabNavigator } from '@react-navigation/bottom-tabs';
import { Ionicons } from '@expo/vector-icons';
import { useAuthStore } from '../store/authStore';

// å¯¼å…¥é¡µé¢ç»„ä»¶
import LoginScreen from '../screens/auth/LoginScreen';
import RegisterScreen from '../screens/auth/RegisterScreen';
import FeedScreen from '../screens/feed/FeedScreen';
import MatchesScreen from '../screens/matches/MatchesScreen';
import ProfileScreen from '../screens/profile/ProfileScreen';

const Stack = createStackNavigator();
const Tab = createBottomTabNavigator();

const MainTabs = () => (
  <Tab.Navigator
    screenOptions={({ route }) => ({
      tabBarIcon: ({ focused, color, size }) => {
        let iconName: keyof typeof Ionicons.glyphMap;

        if (route.name === 'Feed') {
          iconName = focused ? 'home' : 'home-outline';
        } else if (route.name === 'Matches') {
          iconName = focused ? 'tennisball' : 'tennisball-outline';
        } else if (route.name === 'Profile') {
          iconName = focused ? 'person' : 'person-outline';
        } else {
          iconName = 'help-outline';
        }

        return <Ionicons name={iconName} size={size} color={color} />;
      },
      tabBarActiveTintColor: '#007AFF',
      tabBarInactiveTintColor: 'gray',
    })}
  >
    <Tab.Screen 
      name="Feed" 
      component={FeedScreen}
      options={{ title: 'åŠ¨æ€' }}
    />
    <Tab.Screen 
      name="Matches" 
      component={MatchesScreen}
      options={{ title: 'çº¦çƒ' }}
    />
    <Tab.Screen 
      name="Profile" 
      component={ProfileScreen}
      options={{ title: 'æˆ‘çš„' }}
    />
  </Tab.Navigator>
);

const AppNavigator = () => {
  const isAuthenticated = useAuthStore((state) => state.isAuthenticated);

  return (
    <NavigationContainer>
      <Stack.Navigator>
        {!isAuthenticated ? (
          <>
            <Stack.Screen 
              name="Login" 
              component={LoginScreen}
              options={{ headerShown: false }}
            />
            <Stack.Screen 
              name="Register" 
              component={RegisterScreen}
              options={{ title: 'æ³¨å†Œ' }}
            />
          </>
        ) : (
          <Stack.Screen 
            name="Main" 
            component={MainTabs}
            options={{ headerShown: false }}
          />
        )}
      </Stack.Navigator>
    </NavigationContainer>
  );
};

export default AppNavigator;
```

### 4.5 ç¤ºä¾‹é¡µé¢ç»„ä»¶

**mobile/src/screens/feed/FeedScreen.tsx**
```typescript
import React, { useEffect } from 'react';
import { View, FlatList, StyleSheet, RefreshControl } from 'react-native';
import { usePostStore } from '../../store/postStore';
import apiClient from '../../services/api';
import PostCard from '../../components/PostCard';

const FeedScreen = () => {
  const { posts, loading, setPosts, setLoading } = usePostStore();

  const fetchPosts = async () => {
    setLoading(true);
    try {
      const response = await apiClient.get('/posts/');
      setPosts(response.data);
    } catch (error) {
      console.error('è·å–åŠ¨æ€å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchPosts();
  }, []);

  return (
    <View style={styles.container}>
      <FlatList
        data={posts}
        renderItem={({ item }) => <PostCard post={item} />}
        keyExtractor={(item) => item.id.toString()}
        refreshControl={
          <RefreshControl refreshing={loading} onRefresh={fetchPosts} />
        }
      />
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#f5f5f5',
  },
});

export default FeedScreen;
```

### 4.6 App å…¥å£æ–‡ä»¶

**mobile/App.tsx**
```typescript
import React from 'react';
import { StatusBar } from 'expo-status-bar';
import { Provider as PaperProvider } from 'react-native-paper';
import AppNavigator from './src/navigation/AppNavigator';

export default function App() {
  return (
    <PaperProvider>
      <StatusBar style="auto" />
      <AppNavigator />
    </PaperProvider>
  );
}
```

## äº”ã€é˜¿é‡Œäº‘éƒ¨ç½²å®è·µ

### 5.1 é˜¿é‡Œäº‘èµ„æºå‡†å¤‡

#### è´­ä¹°å’Œé…ç½®èµ„æº
1. **ECS äº‘æœåŠ¡å™¨**
   - æ¨èé…ç½®ï¼š2æ ¸4GBå†…å­˜ï¼Œ40GBç³»ç»Ÿç›˜
   - æ“ä½œç³»ç»Ÿï¼šUbuntu 20.04 LTS
   - å¸¦å®½ï¼š5Mbpsï¼ˆæŒ‰éœ€è°ƒæ•´ï¼‰

2. **RDS PostgreSQL æ•°æ®åº“** (æ¨èä½¿ç”¨äº‘ RDS æœåŠ¡)
   - è§„æ ¼ï¼šåŸºç¡€ç‰ˆ 1æ ¸1GB èµ·æ­¥
   - å­˜å‚¨ï¼š20GB SSD
   - é…ç½®ç™½åå•ï¼ˆæ·»åŠ  ECS å†…ç½‘IPï¼‰
   - ä¼˜åŠ¿ï¼šè‡ªåŠ¨å¤‡ä»½ã€é«˜å¯ç”¨ã€ç›‘æ§å‘Šè­¦ã€å®‰å…¨é˜²æŠ¤

3. **OSS å¯¹è±¡å­˜å‚¨**
   - åˆ›å»º Bucketï¼ˆç§æœ‰è¯»å†™ï¼‰
   - é…ç½®è·¨åŸŸè§„åˆ™ï¼ˆCORSï¼‰
   - å¼€å¯ CDN åŠ é€Ÿï¼ˆå¯é€‰ï¼‰

4. **åŸŸåå’ŒSSLè¯ä¹¦**
   - åŸŸåå¤‡æ¡ˆ
   - ç”³è¯·å…è´¹ SSL è¯ä¹¦

### 5.2 æœåŠ¡å™¨ç¯å¢ƒé…ç½®

```bash
# SSH è¿æ¥åˆ° ECS
ssh root@your-server-ip

# æ›´æ–°ç³»ç»Ÿ
apt update && apt upgrade -y

# å®‰è£… Python 3.9+
apt install python3.9 python3.9-venv python3-pip -y

# å®‰è£… Nginx
apt install nginx -y

# å®‰è£… PostgreSQL å®¢æˆ·ç«¯ï¼ˆå¦‚éœ€æœ¬åœ°æ•°æ®åº“ï¼‰
apt install postgresql-client -y

# å®‰è£… Supervisorï¼ˆè¿›ç¨‹ç®¡ç†ï¼‰
apt install supervisor -y

# å®‰è£… Git
apt install git -y
```

### 5.3 éƒ¨ç½²åç«¯åº”ç”¨

```bash
# åˆ›å»ºåº”ç”¨ç›®å½•
mkdir -p /var/www/tennis_backend
cd /var/www/tennis_backend

# å…‹éš†ä»£ç ï¼ˆæˆ–ä½¿ç”¨ scp/ftp ä¸Šä¼ ï¼‰
git clone your-repository-url .

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3.9 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# åˆ›å»º .env é…ç½®æ–‡ä»¶
nano .env
```

**.env é…ç½®ç¤ºä¾‹ï¼š**
```env
# PostgreSQL æ•°æ®åº“è¿æ¥ (ä½¿ç”¨äº‘ RDS PostgreSQL)
DATABASE_URL=postgresql://username:password@rm-xxxxx.pg.rds.aliyuncs.com:5432/tennis_db
SECRET_KEY=your-production-secret-key-change-this
DEBUG=False
ALIYUN_OSS_ACCESS_KEY_ID=your-access-key-id
ALIYUN_OSS_ACCESS_KEY_SECRET=your-access-key-secret
ALIYUN_OSS_BUCKET_NAME=tennis-social
ALIYUN_OSS_ENDPOINT=oss-cn-hangzhou.aliyuncs.com
```

```bash
# æ•°æ®åº“è¿ç§»
alembic upgrade head

# æµ‹è¯•è¿è¡Œ
uvicorn main:app --host 0.0.0.0 --port 8000
```

### 5.4 é…ç½® Supervisorï¼ˆè¿›ç¨‹å®ˆæŠ¤ï¼‰

```bash
# åˆ›å»º Supervisor é…ç½®
nano /etc/supervisor/conf.d/tennis_backend.conf
```

**tennis_backend.conf å†…å®¹ï¼š**
```ini
[program:tennis_backend]
directory=/var/www/tennis_backend
command=/var/www/tennis_backend/venv/bin/uvicorn main:app --host 127.0.0.1 --port 8000 --workers 4
user=www-data
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/tennis_backend.log
```

```bash
# é‡è½½é…ç½®å¹¶å¯åŠ¨
supervisorctl reread
supervisorctl update
supervisorctl start tennis_backend

# æŸ¥çœ‹çŠ¶æ€
supervisorctl status
```

### 5.5 é…ç½® Nginx åå‘ä»£ç†

```bash
# åˆ›å»º Nginx é…ç½®
nano /etc/nginx/sites-available/tennis_api
```

**tennis_api é…ç½®å†…å®¹ï¼š**
```nginx
server {
    listen 80;
    server_name api.yourdomain.com;
    
    # é‡å®šå‘åˆ° HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name api.yourdomain.com;
    
    # SSL è¯ä¹¦é…ç½®
    ssl_certificate /path/to/your/certificate.crt;
    ssl_certificate_key /path/to/your/private.key;
    
    # SSL ä¼˜åŒ–
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    
    # æ—¥å¿—
    access_log /var/log/nginx/tennis_api_access.log;
    error_log /var/log/nginx/tennis_api_error.log;
    
    # åå‘ä»£ç†åˆ° FastAPI
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocket æ”¯æŒï¼ˆå¦‚éœ€è¦ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
    
    # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
    client_max_body_size 10M;
}
```

```bash
# å¯ç”¨é…ç½®
ln -s /etc/nginx/sites-available/tennis_api /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
nginx -t

# é‡å¯ Nginx
systemctl restart nginx
```

### 5.6 é…ç½®é˜¿é‡Œäº‘ OSSï¼ˆå›¾ç‰‡ä¸Šä¼ ï¼‰

**backend/app/services/oss.py**
```python
import oss2
from app.core.config import settings

class OSSService:
    def __init__(self):
        auth = oss2.Auth(
            settings.ALIYUN_OSS_ACCESS_KEY_ID,
            settings.ALIYUN_OSS_ACCESS_KEY_SECRET
        )
        self.bucket = oss2.Bucket(
            auth,
            settings.ALIYUN_OSS_ENDPOINT,
            settings.ALIYUN_OSS_BUCKET_NAME
        )
    
    def upload_file(self, file_path: str, file_data: bytes) -> str:
        """ä¸Šä¼ æ–‡ä»¶åˆ° OSS"""
        self.bucket.put_object(file_path, file_data)
        # è¿”å›æ–‡ä»¶ URL
        return f"https://{settings.ALIYUN_OSS_BUCKET_NAME}.{settings.ALIYUN_OSS_ENDPOINT}/{file_path}"
    
    def delete_file(self, file_path: str):
        """åˆ é™¤ OSS æ–‡ä»¶"""
        self.bucket.delete_object(file_path)

oss_service = OSSService()
```

### 5.7 Expo åº”ç”¨å‘å¸ƒ

#### é…ç½® EAS Build

```bash
cd mobile

# å®‰è£… EAS CLI
npm install -g eas-cli

# ç™»å½• Expo è´¦å·
eas login

# åˆå§‹åŒ– EAS é…ç½®
eas build:configure
```

**mobile/eas.json**
```json
{
  "build": {
    "development": {
      "developmentClient": true,
      "distribution": "internal"
    },
    "preview": {
      "distribution": "internal",
      "android": {
        "buildType": "apk"
      }
    },
    "production": {
      "android": {
        "buildType": "app-bundle"
      }
    }
  },
  "submit": {
    "production": {}
  }
}
```

#### Android APK/AAB æ‰“åŒ…
```bash
cd mobile

# æ„å»ºé¢„è§ˆç‰ˆ APK
eas build --platform android --profile preview

# æ„å»ºç”Ÿäº§ç‰ˆ AAB (ç”¨äº Google Play)
eas build --platform android --profile production

# æ„å»ºå®Œæˆåï¼ŒEAS ä¼šæä¾›ä¸‹è½½é“¾æ¥
```

#### iOS IPA æ‰“åŒ…
```bash
cd mobile

# æ„å»º iOS åº”ç”¨
eas build --platform ios --profile production

# é¦–æ¬¡æ„å»ºéœ€è¦é…ç½® Apple Developer è´¦å·
# æŒ‰ç…§æç¤ºå®Œæˆé…ç½®
```

#### åº”ç”¨æäº¤åˆ°åº”ç”¨å•†åº—
```bash
# æäº¤åˆ° Google Play
eas submit --platform android

# æäº¤åˆ° App Store
eas submit --platform ios
```

#### æœ¬åœ°æ„å»ºï¼ˆå¯é€‰ï¼‰
```bash
# å¦‚æœéœ€è¦æœ¬åœ°æ„å»ºï¼Œéœ€è¦å…ˆ ejectï¼ˆä¸æ¨è Managed Workflowï¼‰
# æˆ–ä½¿ç”¨ Expo Development Build
npx expo install expo-dev-client
eas build --profile development --platform android
```

## å…­ã€å¼€å‘æœ€ä½³å®è·µ

### 6.1 Git å·¥ä½œæµ
```bash
# åŠŸèƒ½åˆ†æ”¯å¼€å‘
git checkout -b feature/post-creation
# å¼€å‘å®Œæˆå
git add .
git commit -m "feat: æ·»åŠ åŠ¨æ€å‘å¸ƒåŠŸèƒ½"
git push origin feature/post-creation
# åˆ›å»º Pull Request åˆå¹¶åˆ° main
```

### 6.2 ä»£ç è§„èŒƒ
- **Pythonï¼š** éµå¾ª PEP 8
- **TypeScriptï¼š** ä½¿ç”¨ ESLint + Prettier
- **Git Commitï¼š** éµå¾ª Conventional Commits

### 6.3 æµ‹è¯•ç­–ç•¥
```bash
# åç«¯å•å…ƒæµ‹è¯•
pytest tests/

# å‰ç«¯æµ‹è¯•
npm test
```

### 6.4 æ€§èƒ½ä¼˜åŒ–
- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- API å“åº”ç¼“å­˜ï¼ˆRedisï¼‰
- å›¾ç‰‡å‹ç¼©å’Œ CDN åŠ é€Ÿ
- åˆ†é¡µåŠ è½½
- æ‡’åŠ è½½ç»„ä»¶

### 6.5 å®‰å…¨æœ€ä½³å®è·µ
- HTTPS åŠ å¯†ä¼ è¾“
- JWT Token è®¤è¯
- SQL æ³¨å…¥é˜²æŠ¤ï¼ˆä½¿ç”¨ ORMï¼‰
- XSS é˜²æŠ¤
- æ•æ„Ÿä¿¡æ¯ç¯å¢ƒå˜é‡å­˜å‚¨
- å®šæœŸå®‰å…¨æ›´æ–°

## ä¸ƒã€ç›‘æ§å’Œè¿ç»´

### 7.1 æ—¥å¿—ç®¡ç†
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /var/log/tennis_backend.log

# Nginx æ—¥å¿—
tail -f /var/log/nginx/tennis_api_access.log
```

### 7.2 æ€§èƒ½ç›‘æ§
- é˜¿é‡Œäº‘äº‘ç›‘æ§
- è‡ªå®šä¹‰ç›‘æ§è„šæœ¬
- æ•°æ®åº“æ…¢æŸ¥è¯¢åˆ†æ

### 7.3 å¤‡ä»½ç­–ç•¥
```bash
# æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½ï¼ˆRDS æä¾›ï¼‰
# ä»£ç å¤‡ä»½ï¼ˆGitï¼‰
# é…ç½®æ–‡ä»¶å¤‡ä»½

# å®šæ—¶å¤‡ä»½è„šæœ¬ç¤ºä¾‹
0 2 * * * /usr/bin/pg_dump -h your-rds-host -U username tennis_db > /backup/tennis_db_$(date +\%Y\%m\%d).sql
```

## å…«ã€æŒç»­é›†æˆ/éƒ¨ç½²ï¼ˆCI/CDï¼‰

### 8.1 GitHub Actions ç¤ºä¾‹

**.github/workflows/deploy.yml**
```yaml
name: Deploy to Aliyun

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Deploy to server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /var/www/tennis_backend
            git pull origin main
            source venv/bin/activate
            pip install -r requirements.txt
            alembic upgrade head
            supervisorctl restart tennis_backend
```

## ä¹ã€å¼€å‘æ—¶é—´çº¿

### ç¬¬1-2å‘¨ï¼šç¯å¢ƒæ­å»ºå’ŒåŸºç¡€æ¡†æ¶
- å¼€å‘ç¯å¢ƒé…ç½®
- é¡¹ç›®åˆå§‹åŒ–
- æ•°æ®åº“è®¾è®¡
- åŸºç¡€ API æ¡†æ¶

### ç¬¬3-4å‘¨ï¼šç”¨æˆ·ç³»ç»Ÿ
- æ³¨å†Œç™»å½•åŠŸèƒ½
- JWT è®¤è¯
- ç”¨æˆ·ä¿¡æ¯ç®¡ç†

### ç¬¬5-6å‘¨ï¼šåŠ¨æ€å‘å¸ƒåŠŸèƒ½
- åŠ¨æ€ CRUD API
- å›¾ç‰‡ä¸Šä¼  OSS
- å‰ç«¯åŠ¨æ€é¡µé¢

### ç¬¬7-8å‘¨ï¼šçº¦çƒåŠŸèƒ½
- çº¦çƒ CRUD API
- çº¦çƒåˆ—è¡¨å’Œç­›é€‰
- å‚ä¸è€…ç®¡ç†

### ç¬¬9-10å‘¨ï¼šç¤¾äº¤äº’åŠ¨
- ç‚¹èµè¯„è®ºåŠŸèƒ½
- å…³æ³¨ç³»ç»Ÿ
- æ¶ˆæ¯é€šçŸ¥

### ç¬¬11-12å‘¨ï¼šæµ‹è¯•å’Œéƒ¨ç½²
- åŠŸèƒ½æµ‹è¯•
- æ€§èƒ½ä¼˜åŒ–
- é˜¿é‡Œäº‘éƒ¨ç½²
- åº”ç”¨å‘å¸ƒ

## åã€å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- Expo: https://docs.expo.dev/
- React Native: https://reactnative.dev/
- Zustand: https://zustand-demo.pmnd.rs/
- Jotai: https://jotai.org/
- React Navigation: https://reactnavigation.org/
- React Native Paper: https://callstack.github.io/react-native-paper/
- FastAPI: https://fastapi.tiangolo.com/
- PostgreSQL: https://www.postgresql.org/docs/
- é˜¿é‡Œäº‘æ–‡æ¡£: https://help.aliyun.com/

### æ¨èæ•™ç¨‹
- Expo å®˜æ–¹æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰
- React Native ä¸­æ–‡ç½‘
- Zustand çŠ¶æ€ç®¡ç†å®è·µ
- FastAPI å®æˆ˜æ•™ç¨‹
- PostgreSQL æ•°æ®åº“è®¾è®¡
- é˜¿é‡Œäº‘éƒ¨ç½²æœ€ä½³å®è·µ
- EAS Build ä½¿ç”¨æŒ‡å—

---

**å¼€å‘å»ºè®®ï¼š**
1. å…ˆå®Œæˆ MVP æ ¸å¿ƒåŠŸèƒ½ï¼Œå†é€æ­¥è¿­ä»£
2. é‡è§†ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§
3. åŠæ—¶æµ‹è¯•ï¼Œå°½æ—©å‘ç°é—®é¢˜
4. å¤šå‚è€ƒä¼˜ç§€å¼€æºé¡¹ç›®
5. ä¿æŒå­¦ä¹ ï¼Œå…³æ³¨æŠ€æœ¯æ›´æ–°

ç¥å¼€å‘é¡ºåˆ©ï¼ğŸ¾

